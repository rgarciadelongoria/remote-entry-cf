import{a as s,b as m,d as u}from"./chunk-TO6NF34E.js";import{a as c,b as p}from"./chunk-OFH4QNJH.js";import"@angular/core";import{catchError as d,map as l,of as g,switchMap as j,tap as n}from"rxjs";import*as i from"@angular/core";import"@angular/core";import{map as h}from"rxjs";import*as o from"@angular/core";var f=(()=>{class r extends u{getMe(){return this.Post("crowdfarmers/me",{}).pipe(h(t=>t.data))}login(t){return this.Post("crowdfarmers/login",t).pipe(h(e=>e.data.token))}static{this.\u0275fac=(()=>{let t;return function(a){return(t||(t=o.\u0275\u0275getInheritedFactory(r)))(a||r)}})()}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var C=(()=>{class r{constructor(t,e,a,v){this.stateSrv=t,this.storageSrv=e,this.routerSrv=a,this.authApiSrv=v}init(){return this.authApiSrv.getMe().pipe(n(t=>this.stateSrv.update("user",t)),l(()=>!0),d(()=>(this.logOut(),g(!0))))}login(t){return this.authApiSrv.login(t).pipe(n(e=>this.storageSrv.setCookie(s.TOKEN,e,{days:7})),j(()=>this.authApiSrv.getMe()),n(e=>this.stateSrv.update("user",e)))}logOut(){this.stateSrv.reset(),this.storageSrv.deleteCookie(s.TOKEN),this.routerSrv.navigate([])}static{this.\u0275fac=function(e){return new(e||r)(i.\u0275\u0275inject(p),i.\u0275\u0275inject(m),i.\u0275\u0275inject(c),i.\u0275\u0275inject(f))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{C as a};
