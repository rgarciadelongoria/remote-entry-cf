import{c as d,d as v}from"./chunk-FVBUAS3B.js";import{c as y,d as S}from"./chunk-DUEWQYKU.js";import{a as u,b as h,c as a}from"./chunk-POLL2CVR.js";import{CommonModule as B}from"@angular/common";import"@angular/core";import{inject as C}from"@angular/core";import{first as A,map as F,switchMap as L,tap as x}from"rxjs";var f={APPEARANCE:{theme:"stripe"},OPTIONS:{layout:{type:"accordion",defaultCollapsed:!0,radios:!0,spacedAccordionItems:!1}}};import{CommonModule as $}from"@angular/common";import"@angular/core";import{BehaviorSubject as R,of as b}from"rxjs";import*as p from"@angular/core";var E=(()=>{let r=class r{get stripeRef(){return this._stripeRef$.getValue()}constructor(t){this.utilsSrv=t,this._stripeRef$=new R(null),this.stripeRef$=this._stripeRef$.asObservable()}get(){return this.stripeRef?b(this.stripeRef):(this.init(),this.stripeRef$)}init(){this.utilsSrv.isPlatformBrowser&&typeof window.Stripe>"u"&&this.utilsSrv.loadScript(d.stripe.URL,this.loadSDK.bind(this))}loadSDK(){this._stripeRef$.next(window.Stripe(d.stripe.code))}};r.\u0275fac=function(i){return new(i||r)(p.\u0275\u0275inject(y))},r.\u0275prov=p.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();var m=function(n){return n.CARD="card",n.IDEAL="ideal",n.SEPA="sepa",n.PAYPAL="paypal",n.CREDITS="credits",n.APPLE_PAY="applePay",n.KLARNA="klarna",n.ELEMENTS="elements",n}(m||{});import"@angular/core";import{map as g}from"rxjs";import*as c from"@angular/core";var w=(()=>{let r=class r extends v{createSecret(t){return this.Get(`payments/secret/stripe/${t}`).pipe(g(i=>i.data))}createIntent(t){return this.Post("payments/intent/stripe",h(u({},t),{platform:"web"})).pipe(g(i=>i.data))}};r.\u0275fac=(()=>{let t;return function(s){return(t||(t=c.\u0275\u0275getInheritedFactory(r)))(s||r)}})(),r.\u0275prov=c.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();import*as e from"@angular/core";import*as I from"@angular/common";var D=["stripeElementsRef"];function j(n,r){n&1&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1," Loading... "),e.\u0275\u0275elementContainerEnd())}var P=(()=>{let r=class r extends S{constructor(){super(...arguments),this.stripeSrv=C(E),this.stripeApiSrv=C(w),this.isReady=!1,this.canPay=!1}ngAfterViewInit(){this.stripeSrv.get().pipe(A(t=>!!t),x(t=>this.stripe=t),L(()=>this.getClientSecret())).subscribe(t=>{try{let i=f.APPEARANCE,s=f.OPTIONS;this.clientSecret=t,this.elements=this.stripe.elements({appearance:i,clientSecret:t}),this.paymentElement=this.elements.create("payment",s),this.paymentElement.mount(this.stripeElementsRef.nativeElement),this.paymentElement.on("ready",()=>{this.isReady=!0,this.listenElementsDataChanges()})}catch(i){console.error(i)}})}submitForm(){return a(this,null,function*(){try{let{error:t}=yield this.elements.submit();if(t)throw t;let i=this.getConfirmData();this.isSetup?yield this.attachPaymentMethod(i):yield this.pay(i)}catch(t){console.error(t)}})}pay(t){return a(this,null,function*(){let{error:i}=yield this.stripe.confirmPayment(t);if(i)throw i})}attachPaymentMethod(t){return a(this,null,function*(){let{setupIntent:i,error:s}=yield this.stripe.confirmSetup(t);if(s)throw s})}getClientSecret(){return(this.isSetup?this.stripeApiSrv.createSecret(m.ELEMENTS):this.getPaymentIntent()).pipe(F(({client_secret:i})=>i))}getPaymentIntent(){let t={amount:this.amount,customer:this.state.user().paymentMethods[0].id,methodTypes:m.ELEMENTS,currency:this.currency};return this.stripeApiSrv.createIntent(t)}listenElementsDataChanges(){this.paymentElement.on("change",t=>{this.canPay=t.complete,this.selectedPaymentMethod=t.value.type})}getConfirmData(){let t=window.location.href,i=t.includes("?"),s=`${t}${i?"&":"?"}selected_payment_method=${this.selectedPaymentMethod}`;return{elements:this.elements,clientSecret:this.clientSecret,redirect:"if_required",confirmParams:{return_url:s}}}};r.\u0275fac=(()=>{let t;return function(s){return(t||(t=e.\u0275\u0275getInheritedFactory(r)))(s||r)}})(),r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["app-stripe-elements"]],viewQuery:function(i,s){if(i&1&&e.\u0275\u0275viewQuery(D,7),i&2){let l;e.\u0275\u0275queryRefresh(l=e.\u0275\u0275loadQuery())&&(s.stripeElementsRef=l.first)}},inputs:{isSetup:"isSetup",amount:"amount",currency:"currency"},standalone:!0,features:[e.\u0275\u0275InheritDefinitionFeature,e.\u0275\u0275StandaloneFeature],decls:7,vars:4,consts:[[4,"ngIf"],["id","payment-form",3,"hidden"],["id","payment-element"],["stripeElementsRef",""],[1,"mt-4"],[1,"w-100",3,"disabled","click"]],template:function(i,s){i&1&&(e.\u0275\u0275template(0,j,2,0,"ng-container",0),e.\u0275\u0275elementStart(1,"form",1),e.\u0275\u0275element(2,"div",2,3),e.\u0275\u0275elementStart(4,"div",4)(5,"button",5),e.\u0275\u0275listener("click",function(){return s.canPay&&s.submitForm()}),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd()()()),i&2&&(e.\u0275\u0275property("ngIf",!s.isReady),e.\u0275\u0275advance(),e.\u0275\u0275property("hidden",!s.isReady),e.\u0275\u0275advance(4),e.\u0275\u0275property("disabled",!s.canPay),e.\u0275\u0275advance(),e.\u0275\u0275textInterpolate1(" ",s.isSetup?"Add":"Pay now"," "))},dependencies:[$,I.NgIf],styles:[".tst[_ngcontent-%COMP%]{color:#000}"]});let n=r;return n})();import*as o from"@angular/core";var de=(()=>{let r=class r{};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=o.\u0275\u0275defineComponent({type:r,selectors:[["app-payment-page"]],standalone:!0,features:[o.\u0275\u0275StandaloneFeature],decls:4,vars:1,consts:[[1,"container","py-5"],[1,"row","justify-content-center"],[1,"col-xl-5"],[3,"isSetup"]],template:function(i,s){i&1&&(o.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),o.\u0275\u0275element(3,"app-stripe-elements",3),o.\u0275\u0275elementEnd()()()),i&2&&(o.\u0275\u0275advance(3),o.\u0275\u0275property("isSetup",!0))},dependencies:[B,P]});let n=r;return n})();export{de as PaymentPageComponent};
